<script>
async function fetchSignals() {
  // Try site-relative first (fast if pages serves it)
  const candidates = [
    '/signals.json',
    // fallback to raw GitHub content (works even if pages hasn't published yet)
    'https://raw.githubusercontent.com/PYHTHRADER/swing-trade-filter-by-momin/main/signals.json'
  ];

  for (const url of candidates) {
    try {
      const res = await fetch(url, { cache: "no-store" });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json();
      return data;
    } catch (err) {
      continue;
    }
  }
  throw new Error('All fetch attempts failed');
}

async function fetchAndRender(){
  const content = document.getElementById('content');
  try{
    const data = await fetchSignals();
    const signals = (data.signals && data.signals.length) ? data.signals : [];
    const gen = data.date || data.generated_at || (new Date()).toISOString();

    if(signals.length === 0){
      content.innerHTML = `<div class="empty">No signals found for <strong>${new Date(gen).toLocaleString()}</strong>.</div>`;
      return;
    }

    let html = `<div class="small">Generated: ${new Date(gen).toLocaleString()}</div>`;
    html += `<table><thead><tr>
      <th>Ticker</th><th>Setup</th><th>Entry</th><th>Stoploss</th><th>Target</th><th>RSI</th><th>RVol</th><th>Exp%</th>
    </tr></thead><tbody>`;

    signals.forEach(s=>{
      html += `<tr>
        <td>${s.ticker || ''}</td>
        <td>${s.setup || ''}</td>
        <td>${s.entry ?? ''}</td>
        <td>${s.stoploss ?? ''}</td>
        <td>${s.target1 ?? ''}</td>
        <td>${s.rsi ?? ''}</td>
        <td>${s.rvol ?? ''}</td>
        <td>${s.expected_move_pct ?? ''}</td>
      </tr>`;
    });

    html += `</tbody></table>`;
    content.innerHTML = html;
  }catch(e){
    content.innerHTML = `<div class="empty">Error loading signals: ${e.message}</div>`;
  }
}
fetchAndRender();
setInterval(fetchAndRender, 60000);
</script>
